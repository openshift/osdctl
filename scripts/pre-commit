#!/bin/bash
set -e
echo "Running pre-commit hook to check docs/ directory..."
CHANGED_FILES=$(git diff --staged --name-only)

# Only check docs if Go files are changed
if echo "$CHANGED_FILES" | grep -q -v "^docs/" && echo "$CHANGED_FILES" | grep -q "\.go$"; then
  echo "Go files changed, checking if docs need updating..."
  
  # Generate docs
  if ! make generate-docs; then
    echo "Failed to generate documentation. Fix errors before committing."
    exit 1
  fi
  
  # Check if any docs files changed but are not staged
  if git diff --name-only | grep -q "^docs/"; then
    echo "ERROR: Documentation in docs/ directory and osdctl_commands.md file is out of date."
    echo "Please stage the updated documentation before committing:"
    echo " git add docs/ osdctl_commands.md"
    exit 1
  fi
fi

echo "Pre-commit hook completed successfully."
exit 0
